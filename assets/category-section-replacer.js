/**
 * Generated by Copilot
 * SAAutomotive Shop by Model Section
 * Menu/submenu structure - chassis codes link to series collections
 */

(function() {
  'use strict';

  // BMW Series with their chassis codes
  // Each model links to its series collection page
  const SERIES_DATA = [
    {
      series: '1 Series',
      url: '/1-series',
      models: ['E81', 'E82', 'E87', 'E88', 'F20', 'F21', 'F40']
    },
    {
      series: '2 Series',
      url: '/2-series',
      models: ['F22', 'F23', 'F44', 'F45', 'G42']
    },
    {
      series: '3 Series',
      url: '/3-series',
      models: ['E90', 'E91', 'E92', 'E93', 'F30', 'F31', 'F34', 'G20', 'G21']
    },
    {
      series: '4 Series',
      url: '/4-series',
      models: ['F32', 'F33', 'F36', 'G22', 'G23', 'G26']
    },
    {
      series: '5 Series',
      url: '/5-series',
      models: ['E60', 'E61', 'F10', 'F11', 'G30', 'G31']
    },
    {
      series: '6 Series',
      url: '/6-series',
      models: ['E63', 'E64', 'F06', 'F12', 'F13', 'G32']
    },
    {
      series: '7 Series',
      url: '/7-series',
      models: ['E65', 'E66', 'F01', 'F02', 'G11', 'G12']
    },
    {
      series: 'X Series',
      url: '/x-series',
      models: ['E70', 'E71', 'E83', 'E84', 'F15', 'F16', 'F25', 'F26', 'F48', 'G01', 'G02', 'G05', 'G06', 'G07']
    }
  ];

  function createSeriesMenu(seriesItem) {
    const modelLinks = seriesItem.models.map(model => 
      `<a href="${seriesItem.url}?model=${model}" class="saa-model-link">${model}</a>`
    ).join('');
    
    return `
      <div class="saa-series-group">
        <a href="${seriesItem.url}" class="saa-series-header">
          <span class="saa-series-name">${seriesItem.series}</span>
          <svg class="saa-arrow" viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
          </svg>
        </a>
        <div class="saa-models-submenu">
          ${modelLinks}
        </div>
      </div>
    `;
  }

  function createModelSection() {
    return `
      <section class="saa-models-section">
        <div class="saa-models-container">
          <h2 class="saa-models-title">Shop by Model</h2>
          <p class="saa-models-subtitle">Select your BMW chassis code</p>
          <div class="saa-models-grid">
            ${SERIES_DATA.map(createSeriesMenu).join('')}
          </div>
        </div>
      </section>
    `;
  }

  function injectStyles() {
    if (document.getElementById('saa-models-css')) return;
    
    const css = `
      /* SAAutomotive Shop by Model Section - Generated by Copilot */
      
      .saa-models-section {
        padding: 60px 20px;
        background: #fafafa;
      }
      
      .saa-models-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .saa-models-title {
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        margin: 0 0 8px 0;
        text-align: center;
      }
      
      .saa-models-subtitle {
        font-size: 16px;
        color: #666;
        margin: 0 0 40px 0;
        text-align: center;
      }
      
      .saa-models-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }
      
      .saa-series-group {
        background: #fff;
        border-radius: 12px;
        border: 1px solid #e0e0e0;
        overflow: hidden;
        transition: box-shadow 0.2s ease;
      }
      
      .saa-series-group:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      }
      
      .saa-series-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        background: #0066b3;
        color: #fff;
        text-decoration: none;
        font-weight: 600;
        font-size: 16px;
        transition: background 0.2s ease;
      }
      
      .saa-series-header:hover {
        background: #004d8a;
      }
      
      .saa-series-name {
        flex: 1;
      }
      
      .saa-arrow {
        flex-shrink: 0;
        opacity: 0.8;
      }
      
      .saa-models-submenu {
        display: flex;
        flex-wrap: wrap;
        padding: 12px;
        gap: 8px;
      }
      
      .saa-model-link {
        display: inline-block;
        padding: 8px 14px;
        background: #f5f5f5;
        border-radius: 6px;
        color: #333;
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s ease;
        border: 1px solid transparent;
      }
      
      .saa-model-link:hover {
        background: #0066b3;
        color: #fff;
        border-color: #0066b3;
      }
      
      /* Tablet */
      @media (max-width: 1024px) {
        .saa-models-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      /* Mobile */
      @media (max-width: 600px) {
        .saa-models-grid {
          grid-template-columns: 1fr;
        }
        .saa-models-section {
          padding: 40px 16px;
        }
        .saa-series-header {
          padding: 14px 16px;
        }
      }
      
      /* Hide demo section */
      [class*="explore"], 
      section:has(h2:contains("Explore")),
      .category-section:not(.saa-models-section) {
        display: none !important;
      }
    `;
    
    const style = document.createElement('style');
    style.id = 'saa-models-css';
    style.textContent = css;
    document.head.appendChild(style);
  }

  function replaceDemoSection() {
    // Find and hide the demo "Explore our range" section
    const headings = document.querySelectorAll('h2, h3');
    let demoSection = null;
    
    headings.forEach(h => {
      if (h.textContent.toLowerCase().includes('explore our range') || 
          h.textContent.toLowerCase().includes('explore')) {
        // Find parent section
        demoSection = h.closest('section') || h.parentElement?.parentElement;
      }
    });
    
    if (demoSection && !document.querySelector('.saa-models-section')) {
      // Hide demo section
      demoSection.style.display = 'none';
      
      // Insert our model menu section after it
      demoSection.insertAdjacentHTML('afterend', createModelSection());
      console.log('[SAA] Shop by Model section injected');
    }
  }

  function init() {
    injectStyles();
    
    // Try immediately
    replaceDemoSection();
    
    // Retry after DOM settles
    setTimeout(replaceDemoSection, 500);
    setTimeout(replaceDemoSection, 1500);
    
    // Watch for dynamic content
    const observer = new MutationObserver(() => {
      if (!document.querySelector('.saa-models-section')) {
        replaceDemoSection();
      }
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
