/**
 * Generated by Copilot
 * SAAutomotive Category Section Replacer
 * Replaces demo "Explore our range" section with BMW parts categories
 */

(function() {
  'use strict';

  const ICON_BASE = 'https://cdn.jsdelivr.net/gh/Stan2891/bmparts-ai@main/assets/category-icons';

  // BMW Parts categories with icons
  const CATEGORIES = [
    { name: 'Lighting', icon: 'lighting.png', url: '/lighting' },
    { name: 'Electrical System', icon: 'electrical-system.png', url: '/electrical-system' },
    { name: 'Engine', icon: 'engine.png', url: '/engine' },
    { name: 'Cooling System', icon: 'cooling-system.png', url: '/cooling-system' },
    { name: 'Suspension', icon: 'suspension.png', url: '/suspension' },
    { name: 'Steering System', icon: 'steering-system.png', url: '/steering-system' },
    { name: 'Bodywork', icon: 'bodywork.png', url: '/bodywork' },
    { name: 'Drivetrain', icon: 'drivetrain-transmission.png', url: '/drivetrain-transmission' },
    { name: 'Airbags', icon: 'airbags.png', url: '/airbags' },
    { name: 'Trim & Interior', icon: 'trim.png', url: '/trim' },
    { name: 'Oil & Lubricants', icon: 'oil-lubricants.png', url: '/oil-lubricants' },
    { name: 'PDC & Cruise Control', icon: 'pdc-distance-cruise-control.png', url: '/pdc-distance-cruise-control' }
  ];

  function createCategoryCard(cat) {
    return `
      <a href="${cat.url}" class="saa-cat-card">
        <div class="saa-cat-icon-wrap">
          <img src="${ICON_BASE}/${cat.icon}" alt="${cat.name}" class="saa-cat-icon" loading="lazy">
        </div>
        <span class="saa-cat-name">${cat.name}</span>
      </a>
    `;
  }

  function createCategoryGrid() {
    return `
      <section class="saa-categories-section">
        <div class="saa-categories-container">
          <h2 class="saa-categories-title">Shop by Category</h2>
          <p class="saa-categories-subtitle">Quality BMW parts for every system</p>
          <div class="saa-categories-grid">
            ${CATEGORIES.map(createCategoryCard).join('')}
          </div>
        </div>
      </section>
    `;
  }

  function injectStyles() {
    if (document.getElementById('saa-categories-css')) return;
    
    const css = `
      /* SAAutomotive Categories Section - Generated by Copilot */
      
      .saa-categories-section {
        padding: 60px 20px;
        background: #fafafa;
      }
      
      .saa-categories-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .saa-categories-title {
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        margin: 0 0 8px 0;
        text-align: center;
      }
      
      .saa-categories-subtitle {
        font-size: 16px;
        color: #666;
        margin: 0 0 40px 0;
        text-align: center;
      }
      
      .saa-categories-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 20px;
      }
      
      .saa-cat-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 24px 16px;
        background: #fff;
        border-radius: 12px;
        text-decoration: none;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border: 1px solid #eee;
      }
      
      .saa-cat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      }
      
      .saa-cat-icon-wrap {
        width: 64px;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 12px;
      }
      
      .saa-cat-icon {
        height: 56px;
        width: auto;
        object-fit: contain;
        transition: transform 0.2s ease;
      }
      
      .saa-cat-card:hover .saa-cat-icon {
        transform: scale(1.05);
      }
      
      .saa-cat-name {
        font-size: 14px;
        font-weight: 600;
        color: #1a1a1a;
        text-align: center;
        line-height: 1.3;
      }
      
      /* Tablet */
      @media (max-width: 1024px) {
        .saa-categories-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      }
      
      /* Mobile */
      @media (max-width: 768px) {
        .saa-categories-grid {
          grid-template-columns: repeat(3, 1fr);
          gap: 12px;
        }
        .saa-cat-card {
          padding: 16px 12px;
        }
        .saa-cat-icon-wrap {
          width: 48px;
          height: 48px;
        }
        .saa-cat-icon {
          height: 42px;
        }
        .saa-cat-name {
          font-size: 12px;
        }
      }
      
      /* Small mobile */
      @media (max-width: 480px) {
        .saa-categories-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      /* Hide demo section */
      [class*="explore"], 
      section:has(h2:contains("Explore")),
      .category-section:not(.saa-categories-section) {
        display: none !important;
      }
    `;
    
    const style = document.createElement('style');
    style.id = 'saa-categories-css';
    style.textContent = css;
    document.head.appendChild(style);
  }

  function replaceDemoSection() {
    // Find and hide the demo "Explore our range" section
    const headings = document.querySelectorAll('h2, h3');
    let demoSection = null;
    
    headings.forEach(h => {
      if (h.textContent.toLowerCase().includes('explore our range') || 
          h.textContent.toLowerCase().includes('explore')) {
        // Find parent section
        demoSection = h.closest('section') || h.parentElement?.parentElement;
      }
    });
    
    if (demoSection && !document.querySelector('.saa-categories-section')) {
      // Hide demo section
      demoSection.style.display = 'none';
      
      // Insert our category grid after it
      demoSection.insertAdjacentHTML('afterend', createCategoryGrid());
      console.log('[SAA] Category section replaced');
    }
  }

  function init() {
    injectStyles();
    
    // Try immediately
    replaceDemoSection();
    
    // Retry after DOM settles
    setTimeout(replaceDemoSection, 500);
    setTimeout(replaceDemoSection, 1500);
    
    // Watch for dynamic content
    const observer = new MutationObserver(() => {
      if (!document.querySelector('.saa-categories-section')) {
        replaceDemoSection();
      }
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
