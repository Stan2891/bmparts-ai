/**
 * Generated by Copilot
 * SAAutomotive Shop by Model Section
 * Menu/submenu structure - chassis codes link to series collections
 */

(function() {
  'use strict';

  // BMW Series with their chassis codes
  // Each model links to its series collection page
  const SERIES_DATA = [
    {
      series: '1 Series',
      url: '/1-series',
      models: ['E81', 'E82', 'E87', 'E88', 'F20', 'F21', 'F40']
    },
    {
      series: '2 Series',
      url: '/2-series',
      models: ['F22', 'F23', 'F44', 'F45', 'G42']
    },
    {
      series: '3 Series',
      url: '/3-series',
      models: ['E90', 'E91', 'E92', 'E93', 'F30', 'F31', 'F34', 'G20', 'G21']
    },
    {
      series: '4 Series',
      url: '/4-series',
      models: ['F32', 'F33', 'F36', 'G22', 'G23', 'G26']
    },
    {
      series: '5 Series',
      url: '/5-series',
      models: ['E60', 'E61', 'F10', 'F11', 'G30', 'G31']
    },
    {
      series: '6 Series',
      url: '/6-series',
      models: ['E63', 'E64', 'F06', 'F12', 'F13', 'G32']
    },
    {
      series: '7 Series',
      url: '/7-series',
      models: ['E65', 'E66', 'F01', 'F02', 'G11', 'G12']
    },
    {
      series: 'X Series',
      url: '/x-series',
      models: ['E70', 'E71', 'E83', 'E84', 'F15', 'F16', 'F25', 'F26', 'F48', 'G01', 'G02', 'G05', 'G06', 'G07']
    }
  ];

  function createSeriesMenu(seriesItem) {
    // All chassis codes link directly to the series page (no ?model= param)
    const modelLinks = seriesItem.models.map(model => 
      `<a href="${seriesItem.url}" class="saa-model-link">${model}</a>`
    ).join('');
    
    // No header - just chassis codes grouped in a box
    return `
      <div class="saa-series-group">
        <div class="saa-models-submenu">
          ${modelLinks}
        </div>
      </div>
    `;
  }

  function createModelSection() {
    return `
      <section class="saa-models-section">
        <div class="saa-models-container">
          <h2 class="saa-models-title">Shop by Model</h2>
          <p class="saa-models-subtitle">Select your BMW chassis code</p>
          <div class="saa-models-grid">
            ${SERIES_DATA.map(createSeriesMenu).join('')}
          </div>
        </div>
      </section>
    `;
  }

  function injectStyles() {
    if (document.getElementById('saa-models-css')) return;
    
    const css = `
      /* SAAutomotive Shop by Model Section - Generated by Copilot */
      
      .saa-models-section {
        padding: 60px 20px;
        background: #fafafa;
      }
      
      .saa-models-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .saa-models-title {
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        margin: 0 0 8px 0;
        text-align: center;
      }
      
      .saa-models-subtitle {
        font-size: 16px;
        color: #666;
        margin: 0 0 40px 0;
        text-align: center;
      }
      
      .saa-models-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }
      
      .saa-series-group {
        display: contents;
      }
      
      .saa-models-submenu {
        display: contents;
      }
      
      .saa-model-link {
        display: inline-block;
        padding: 12px 20px;
        background: #fff;
        border-radius: 8px;
        color: #1a1a1a;
        text-decoration: none;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.2s ease;
        border: 2px solid #e0e0e0;
        min-width: 70px;
        text-align: center;
      }
      
      .saa-model-link:hover {
        background: #0066b3;
        color: #fff;
        border-color: #0066b3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,102,179,0.3);
      }
      
      /* Mobile */
      @media (max-width: 600px) {
        .saa-models-section {
          padding: 40px 16px;
        }
        .saa-model-link {
          padding: 10px 16px;
          font-size: 14px;
          min-width: 60px;
        }
      }
      
      /* Hide demo section (desktop + mobile) */
      .zcs-mobile-category,
      .zp-hidden-md.zp-hidden-sm.zp-hidden-xs:has(.zcs_category_icon) {
        display: none !important;
      }

      /* Fallback: enlarge category icons if section still visible */
      .zcs_category_icon img,
      .zs-category-hover-effect img {
        width: 80px !important;
        height: 80px !important;
        min-width: 80px !important;
        min-height: 80px !important;
      }
      @media (max-width: 768px) {
        .zcs_category_icon img,
        .zs-category-hover-effect img {
          width: 70px !important;
          height: 70px !important;
          min-width: 70px !important;
          min-height: 70px !important;
        }
      }
    `;
    
    const style = document.createElement('style');
    style.id = 'saa-models-css';
    style.textContent = css;
    document.head.appendChild(style);
  }

  function replaceDemoSection() {
    // Find and hide the demo "Explore our range" section
    const headings = document.querySelectorAll('h2, h3');
    let demoSection = null;
    
    // First try mobile-specific category container
    demoSection = document.querySelector('.zcs-mobile-category');
    
    // Then try desktop section
    if (!demoSection) {
      headings.forEach(h => {
        if (h.textContent.toLowerCase().includes('explore our range') || 
            h.textContent.toLowerCase().includes('explore')) {
          demoSection = h.closest('.zpsection') || h.closest('section') || h.parentElement?.parentElement;
        }
      });
    }
    
    // Also hide any additional desktop-only category sections
    const desktopCat = document.querySelector('.zp-hidden-md.zp-hidden-sm.zp-hidden-xs:has(.zcs_category_icon)');
    if (desktopCat) desktopCat.style.display = 'none';
    
    if (demoSection && !document.querySelector('.saa-models-section')) {
      // Hide demo section
      demoSection.style.display = 'none';
      
      // Insert our model menu section after it
      demoSection.insertAdjacentHTML('afterend', createModelSection());
      console.log('[SAA] Shop by Model section injected');
    }
  }

  function init() {
    injectStyles();
    
    // Try immediately
    replaceDemoSection();
    
    // Retry after DOM settles
    setTimeout(replaceDemoSection, 500);
    setTimeout(replaceDemoSection, 1500);
    
    // Watch for dynamic content
    const observer = new MutationObserver(() => {
      if (!document.querySelector('.saa-models-section')) {
        replaceDemoSection();
      }
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
